generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  userID            String             @id @default(uuid())
  name              String
  username          String             @unique
  password          String
  createdAt         DateTime           @default(now())
  role              String
  firmas            Firma[]
  formatos          Formato[]
  formatoUsuarios   FormatoUsuario[]
  plantillas        PlantillaFormato[]
  formatosRecibidos Formato[]          @relation("FormatosRecibidos")
}

model Formato {
  formatoID       String            @id @default(uuid())
  tipo            String
  data            String
  createdAt       DateTime          @default(now())
  usuarioId       String
  name            String
  plantillaID     String?
  publicLink      String            @unique @default(cuid())
  firmas          Firma[]
  plantilla       PlantillaFormato? @relation("PlantillaDeFormato", fields: [plantillaID], references: [plantillaID])
  ownerID         Usuario           @relation(fields: [usuarioId], references: [userID])
  formatoUsuarios FormatoUsuario[]
  receptores      Usuario[]         @relation("FormatosRecibidos")
}

model FormatoUsuario {
  id        String  @id @default(uuid())
  userId    String
  formatoId String
  creadoPor Boolean @default(false)
  formato   Formato @relation(fields: [formatoId], references: [formatoID])
  user      Usuario @relation(fields: [userId], references: [userID])

  @@unique([userId, formatoId])
}

model Firma {
  firmaID   String   @id @default(uuid())
  tipo      String
  imagenUrl String
  createdAt DateTime @default(now())
  usuarioId String
  formatoId String?
  formato   Formato? @relation(fields: [formatoId], references: [formatoID])
  usuario   Usuario  @relation(fields: [usuarioId], references: [userID])
}

model PlantillaFormato {
  plantillaID String    @id @default(uuid())
  nombre      String
  descripcion String?
  estructura  Json
  createdAt   DateTime  @default(now())
  creadoPorId String
  numSubfilas Int       @default(3)
  formatos    Formato[] @relation("PlantillaDeFormato")
  creadoPor   Usuario   @relation(fields: [creadoPorId], references: [userID])
}
